<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Rover Controller</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .controller-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            max-width: 500px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .status-display {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 25px;
            border-left: 4px solid #007bff;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .status-label {
            font-weight: bold;
            color: #495057;
        }

        .status-value {
            color: #007bff;
            font-family: monospace;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .control-btn {
            background: linear-gradient(145deg, #007bff, #0056b3);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
        }

        .control-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(0, 123, 255, 0.3);
        }

        .control-btn.stop {
            background: linear-gradient(145deg, #dc3545, #c82333);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .control-btn.stop:hover {
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        .control-btn.diagonal {
            background: linear-gradient(145deg, #28a745, #218838);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .control-btn.diagonal:hover {
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .speed-controls {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .speed-label {
            text-align: center;
            font-weight: bold;
            color: #495057;
            margin-bottom: 15px;
        }

        .speed-display {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 15px;
        }

        .speed-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .speed-btn {
            background: linear-gradient(145deg, #ffc107, #e0a800);
            color: #212529;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            font-weight: bod;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
        }

        .speed-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 193, 7, 0.4);
        }

        .connection-status {
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .test-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .test-btn {
            background: linear-gradient(145deg, #6f42c1, #5a32a3);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(111, 66, 193, 0.3);
        }

        .test-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(111, 66, 193, 0.4);
        }

        @media (max-width: 480px) {
            .controller-container {
                padding: 20px;
            }
            
            .controls-grid {
                gap: 10px;
            }
            
            .control-btn {
                padding: 15px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="controller-container">
        <div class="header">
            <h1>üöó Rover Control</h1>
            <div id="connectionStatus" class="connection-status disconnected">
                üî¥ Connecting to Firebase...
            </div>
        </div>

        <div class="status-display">
            <div class="status-item">
                <span class="status-label">Status:</span>
                <span class="status-value" id="roverStatus">Connecting...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Last Command:</span>
                <span class="status-value" id="lastCommand">None</span>
            </div>
            <div class="status-item">
                <span class="status-label">Movement:</span>
                <span class="status-value" id="currentMovement">Unknown</span>
            </div>
            <div class="status-item">
                <span class="status-label">Arduino Status:</span>
                <span class="status-value" id="arduinoStatus">Waiting...</span>
            </div>
        </div>

        <div class="controls-grid">
            <!-- Row 1 -->
            <div></div>
            <button class="control-btn" onclick="sendCommand('F')" id="forward-btn">
                ‚¨ÜÔ∏è<br>FORWARD
            </button>
            <div></div>

            <!-- Row 2 -->
            <button class="control-btn" onclick="sendCommand('L')" id="left-btn">
                ‚¨ÖÔ∏è<br>LEFT
            </button>
            <button class="control-btn stop" onclick="sendCommand('S')" id="stop-btn">
                ‚èπÔ∏è<br>STOP
            </button>
            <button class="control-btn" onclick="sendCommand('R')" id="right-btn">
                ‚û°Ô∏è<br>RIGHT
            </button>

            <!-- Row 3 -->
            <button class="control-btn diagonal" onclick="sendCommand('FL')" id="fl-btn">
                ‚ÜñÔ∏è<br>FWD-L
            </button>
            <button class="control-btn" onclick="sendCommand('B')" id="backward-btn">
                ‚¨áÔ∏è<br>BACKWARD
            </button>
            <button class="control-btn diagonal" onclick="sendCommand('FR')" id="fr-btn">
                ‚ÜóÔ∏è<br>FWD-R
            </button>
        </div>

        <div class="speed-controls">
            <div class="speed-label">Motor Speed Control</div>
            <div class="speed-display" id="speedDisplay">255</div>
            <div class="speed-buttons">
                <button class="speed-btn" onclick="sendCommand('SPEED_DOWN')" title="Decrease Speed">‚àí</button>
                <button class="speed-btn" onclick="sendCommand('SPEED_UP')" title="Increase Speed">+</button>
            </div>
        </div>

        <div class="test-controls">
            <button class="test-btn" onclick="sendCommand('TEST')">üîß Test Motors</button>
            <button class="test-btn" onclick="refreshStatus()">üîÑ Refresh</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getDatabase, ref, set, onValue, push } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js';

        // Firebase configuration - UPDATE THESE VALUES
        const firebaseConfig = {
            apiKey: "AIzaSyCiz6UMdlXMS1X__EM1z8HT1we0uK3E7Ko",
            authDomain: "rccontroller-977ef.firebaseapp.com",
            databaseURL: "https://rccontroller-977ef-default-rtdb.firebaseio.com",
            projectId: "rccontroller-977ef",
            storageBucket: "rccontroller-977ef.firebasestorage.app",
            messagingSenderId: "602859402821",
            appId: "1:602859402821:web:01ddfa65552c0c4c8ad52c"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Global variables
        let isConnected = false;
        let lastCommandSent = '';

        // Initialize the controller
        window.addEventListener('load', initController);

        function initController() {
            console.log('Initializing Firebase Rover Controller...');
            
            // Listen for connection status
            const connectedRef = ref(database, '.info/connected');
            onValue(connectedRef, (snapshot) => {
                isConnected = snapshot.val() === true;
                updateConnectionStatus();
            });

            // Listen for rover status updates
            const statusRef = ref(database, 'rover/status');
            onValue(statusRef, (snapshot) => {
                const status = snapshot.val();
                if (status) {
                    document.getElementById('roverStatus').textContent = status;
                }
            });

            // Listen for Arduino status updates
            const arduinoStatusRef = ref(database, 'rover/arduino_status');
            onValue(arduinoStatusRef, (snapshot) => {
                const status = snapshot.val();
                if (status) {
                    document.getElementById('arduinoStatus').textContent = status;
                }
            });

            // Listen for current movement updates
            const movementRef = ref(database, 'rover/current_movement');
            onValue(movementRef, (snapshot) => {
                const movement = snapshot.val();
                if (movement) {
                    document.getElementById('currentMovement').textContent = movement;
                }
            });

            // Listen for current speed updates
            const speedRef = ref(database, 'rover/current_speed');
            onValue(speedRef, (snapshot) => {
                const speed = snapshot.val();
                if (speed) {
                    document.getElementById('speedDisplay').textContent = speed;
                }
            });

            // Listen for command confirmations
            const commandRef = ref(database, 'rover/command');
            onValue(commandRef, (snapshot) => {
                const command = snapshot.val();
                if (command) {
                    document.getElementById('lastCommand').textContent = command;
                    highlightActiveButton(command);
                }
            });
        }

        // Send command to Firebase
        window.sendCommand = function(command) {
            if (!isConnected) {
                alert('Not connected to Firebase!');
                return;
            }

            console.log('Sending command:', command);
            
            // Send command to rover
            const commandRef = ref(database, 'rover/command');
            set(commandRef, command).then(() => {
                console.log('Command sent successfully:', command);
                lastCommandSent = command;
                
                // Add to command history
                const historyRef = ref(database, 'rover/command_history');
                push(historyRef, {
                    command: command,
                    timestamp: Date.now(),
                    source: 'web_controller'
                });
                
                // Provide visual feedback
                flashButton(command);
            }).catch((error) => {
                console.error('Error sending command:', error);
                alert('Failed to send command: ' + error.message);
            });
        };

        // Update connection status display
        function updateConnectionStatus() {
            const statusElement = document.getElementById('connectionStatus');
            if (isConnected) {
                statusElement.className = 'connection-status connected';
                statusElement.innerHTML = 'üü¢ Connected to Firebase';
            } else {
                statusElement.className = 'connection-status disconnected';
                statusElement.innerHTML = 'üî¥ Disconnected from Firebase';
            }
        }

        // Highlight the active button based on current command
        function highlightActiveButton(command) {
            // Remove previous highlights
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.style.opacity = '1';
            });

            // Highlight current command button
            const buttonMap = {
                'F': 'forward-btn',
                'B': 'backward-btn',
                'L': 'left-btn',
                'R': 'right-btn',
                'S': 'stop-btn',
                'FL': 'fl-btn',
                'FR': 'fr-btn'
            };

            const buttonId = buttonMap[command];
            if (buttonId) {
                const button = document.getElementById(buttonId);
                if (button) {
                    button.style.opacity = '0.7';
                    setTimeout(() => {
                        button.style.opacity = '1';
                    }, 200);
                }
            }
        }

        // Flash button when pressed
        function flashButton(command) {
            const buttonMap = {
                'F': 'forward-btn',
                'B': 'backward-btn',
                'L': 'left-btn',
                'R': 'right-btn',
                'S': 'stop-btn',
                'FL': 'fl-btn',
                'FR': 'fr-btn'
            };

            const buttonId = buttonMap[command];
            if (buttonId) {
                const button = document.getElementById(buttonId);
                if (button) {
                    button.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        button.style.transform = 'scale(1)';
                    }, 150);
                }
            }
        }

        // Refresh status
        window.refreshStatus = function() {
            console.log('Refreshing status...');
            // Force refresh by updating a timestamp
            const refreshRef = ref(database, 'rover/last_refresh');
            set(refreshRef, Date.now());
        };

        // Keyboard controls
        document.addEventListener('keydown', (event) => {
            if (event.target.tagName === 'INPUT') return; // Don't interfere with input fields
            
            switch(event.key.toLowerCase()) {
                case 'w':
                case 'arrowup':
                    event.preventDefault();
                    sendCommand('F');
                    break;
                case 's':
                case 'arrowdown':
                    event.preventDefault();
                    sendCommand('B');
                    break;
                case 'a':
                case 'arrowleft':
                    event.preventDefault();
                    sendCommand('L');
                    break;
                case 'd':
                case 'arrowright':
                    event.preventDefault();
                    sendCommand('R');
                    break;
                case ' ':
                case 'x':
                    event.preventDefault();
                    sendCommand('S');
                    break;
                case 'q':
                    event.preventDefault();
                    sendCommand('FL');
                    break;
                case 'e':
                    event.preventDefault();
                    sendCommand('FR');
                    break;
                case '+':
                case '=':
                    event.preventDefault();
                    sendCommand('SPEED_UP');
                    break;
                case '-':
                case '_':
                    event.preventDefault();
                    sendCommand('SPEED_DOWN');
                    break;
            }
        });

        // Add keyboard help
        console.log('Keyboard Controls:');
        console.log('W/‚Üë = Forward, S/‚Üì = Backward');
        console.log('A/‚Üê = Left, D/‚Üí = Right');
        console.log('Space/X = Stop');
        console.log('Q = Forward-Left, E = Forward-Right');
        console.log('+/= = Speed Up, -/_ = Speed Down');
    </script>
</body>
</html>l
